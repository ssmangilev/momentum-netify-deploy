(()=>{"use strict";const e=function(){const e={weekday:"long",day:"numeric",month:"long"},t={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,hours12:!1},n=JSON.parse(window.localStorage.getItem("settings")).lang,o=document.getElementById("date"),a=document.getElementById("time");let l=new Date;o.innerHTML="en"===n?l.toLocaleDateString("en-US",e):l.toLocaleDateString("ru-RU",e),a.innerHTML=l.toLocaleTimeString("en-GB",t),window.setInterval((()=>{a.innerHTML=(new Date).toLocaleTimeString("en-GB")}),1e3)},t={en:{night:"Good night",day:"Good afternoon",morning:"Good morning",evening:"Good evening",placeholder:"[Enter name]",settings:"Settings",language:"Language",images:"Images sourses",display:"Display",save:"save",exit:"exit",switcher_eng:"EN",switcher_ru:"RU",wind_speed:"Wind speed: ",ms:"m/s",humidity:"Humidity: ",tags_placeholder:'Enter tags, separator is "," '},ru:{night:"Доброй ночи",day:"Добрый день",morning:"Доброе утро",evening:"Добрый вечер",placeholder:"[Введите имя]",settings:"Настройки",language:"Язык",images:"Источник изображений",display:"Отображение",save:"Сохранить",exit:"Выйти",switcher_eng:"АНГЛ",switcher_ru:"РУС",wind_speed:"Скорость ветра: ",ms:"м/с",humidity:"Влажность: ",tags_placeholder:'Введите теги, разделитель "," '}};function n(e,n){return t[e][n]}function o(){const e=JSON.parse(window.localStorage.getItem("settings")).lang,t=document.getElementById("name");t.addEventListener("change",(e=>{window.localStorage.setItem("username",e.target.value)})),window.setInterval((()=>{const t={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,hours12:!1},o=document.getElementById("greeting_span");let a=(new Date).toLocaleTimeString("en-GB",t).split(":");a[0]>=0&&a[0]<6?o.innerHTML=n(e,"night"):a[0]>=6&&a[0]<12?o.innerHTML=n(e,"morning"):a[0]>=12&&a[0]<18?o.innerHTML=n(e,"day"):a[0]>=18&&a[0]<24&&(o.innerHTML=n(e,"evening"))}),1e3),t.placeholder=n(e,"placeholder")}async function a(){const e=await function(){const e=JSON.parse(window.localStorage.getItem("settings")).lang||"en";return fetch(`../assets/quotes_${e}.json`).then((e=>e.json()))}(),t=document.getElementById("author"),n=document.getElementById("quote"),o=Math.floor(Math.random(0,1)*e.length);t.innerHTML=e[o].author,n.innerHTML=e[o].quote}const l=[{title:"Aqua Caelestis",src:"../assets/sounds/Aqua Caelestis.mp3",duration:"00:39"},{title:"Ennio Morricone",src:"../assets/sounds/Ennio Morricone.mp3",duration:"01:37"},{title:"River Flows In You",src:"../assets/sounds/River Flows In You.mp3",duration:"01:37"},{title:"Summer Wind",src:"../assets/sounds/Summer Wind.mp3",duration:"01:50"}];let s=new Audio;function i(){const e=document.getElementById("track-title");document.getElementById("duration"),document.getElementById("play-list");let t=d();e.innerHTML=l[t].title,s.src=l[t].src}function d(){let e=document.getElementById("play-list"),t=0;for(let n=0;n<e.children.length;n++)if(e.children[n].classList.contains("item-active")){t=n;break}return t}function c(){document.getElementById("play").classList.toggle("pause"),s.paused?s.play():s.pause()}function r(){let e=d(),t=document.getElementById("play-list");t.children[e].classList.toggle("item-active"),e==t.children.length-1?e=0:e+=1,t.children[e].classList.toggle("item-active"),i(),document.getElementById("play").classList.remove("pause"),c()}function m(e){let t=parseInt(e),n=parseInt(t/60);t-=60*n;const o=parseInt(n/60);return n-=60*o,0===o?`${n}:${String(t%60).padStart(2,0)}`:`${String(o).padStart(2,0)}:${n}:${String(t%60).padStart(2,0)}`}function g(){let e="";const t=JSON.parse(window.localStorage.getItem("settings")),n={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,hours12:!1};let o=(new Date).toLocaleTimeString("en-GB",n).split(":");return o[0]>=0&&o[0]<6?e="night":o[0]>=6&&o[0]<12?e="morning":o[0]>=12&&o[0]<18?e="day":o[0]>=18&&o[0]<24&&(e="evening"),"github"===t.imagesSource?`https://raw.githubusercontent.com/ssmangilev/stage1-tasks/assets/images/${e}/`:"flickr"===t.imagesSource?t.tags?`https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=a8811d6255c96de75c697dfae134a8f4&text=${e}&extras=url_l&format=json&nojsoncallback=1&tags=${t.tags}`:`https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=a8811d6255c96de75c697dfae134a8f4&text=${e}&extras=url_l&format=json&nojsoncallback=1`:"unsplash"===t.imagesSource?t.tags?`https://api.unsplash.com/photos/?orientation=landscape&query=${e}&count=30&client_id=NMj_r00jFCUezcLl9rTyUyAqK5GRRvyP05k2ahxAQ4M&categories=${t.tags}`:`https://api.unsplash.com/photos/?orientation=landscape&query=${e}&count=30&client_id=NMj_r00jFCUezcLl9rTyUyAqK5GRRvyP05k2ahxAQ4M`:void 0}async function u(e){let t=[];const n=JSON.parse(window.localStorage.getItem("settings")).imagesSource;if("github"===n)for(let n=1;n<=20;n++){let o=n<10?e+`0${n}.webp`:e+`${n}.webp`;t.push(o)}else if("flickr"===n){const n=await fetch(e).then((e=>e.json()));for(let e=0;e<50&&(void 0!==n.photos.photo[e].url_l&&t.push(n.photos.photo[e].url_l),20!==t.length);e++);}else if("unsplash"===n){const n=await fetch(e).then((e=>e.json()));for(let e=0;e<n.length;e++)void 0!==n[e].urls.full&&t.push(n[e].urls.full)}const o=await Promise.all(t.map((async e=>fetch(e).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))))),a=Math.floor(20*Math.random());window.localStorage.setItem("imageNumber",a),window.localStorage.setItem("sliderImages",o),document.getElementById("body").style.backgroundImage=`url(${o[a]})`}async function y(){document.getElementById("city").addEventListener("change",(e=>{window.localStorage.setItem("city",e.target.value),y()}));const e=window.localStorage.getItem("city");new Headers({Accept:"application/json","Content-Type":"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.54 Safari/537.36"});const t=JSON.parse(window.localStorage.getItem("settings")).lang,o=`http://api.openweathermap.org/data/2.5/weather?q=${e}&appid=68b12f971d6b5bb4fbf4c5239217920e&units=metric&lang=${t}`,a=await fetch(o,{mode:"cors"}).then((e=>e.json()));a.message?(document.getElementById("description-container").style.display="none",document.getElementById("weather-icon").style.display="none",document.getElementById("wind").style.display="none",document.getElementById("humidity").style.display="none",document.getElementById("weather-error").style.display="block",document.getElementById("weather-error").innerHTML=a.message):(document.getElementById("description-container").style.display="flex",document.getElementById("weather-icon").style.display="block",document.getElementById("wind").style.display="block",document.getElementById("humidity").style.display="block",document.getElementById("wind").innerHTML=`${n(t,"wind_speed")} ${Math.floor(a.wind.speed)} ${n(t,"ms")}`,document.getElementById("humidity").innerHTML=`${n(t,"humidity")} ${Math.floor(a.main.humidity)} %`,document.getElementById("temp").innerHTML=`${Math.floor(a.main.temp)}°C`,document.getElementById("weather-description").innerHTML=`${a.weather[0].description}`,document.getElementById("weather-icon").className="weather-icon owf",document.getElementById("weather-icon").classList.add(`owf-${a.weather[0].id}`),document.getElementById("weather-error").style.display="none")}function p(){const e=JSON.parse(window.localStorage.getItem("settings")).lang;document.getElementById("modal-title").textContent=n(e,"settings"),document.getElementById("switcher_eng").textContent=n(e,"switcher_eng"),document.getElementById("switcher_ru").textContent=n(e,"switcher_ru"),document.getElementById("images_source").textContent=n(e,"images"),document.getElementById("block-title").textContent=n(e,"display"),document.getElementById("modal-button-save").textContent=n(e,"save"),document.getElementById("modal-button-exit").textContent=n(e,"exit"),document.getElementById("tags").placeholder=n(e,"tags_placeholder")}function h(){const e=JSON.parse(window.localStorage.getItem("settings")).blocks,t=["weather","player","name","greeting","quote-container","date","time"];for(let n=0;n<t.length;n++){const o=document.getElementById(t[n]);-1!==e.indexOf(t[n])?o.style.display="quote-container"===t[n]?"block":"flex":o.style.display="none"}}document.addEventListener("DOMContentLoaded",(()=>{if(u(g()),o(),e(),function(){let e=document.getElementById("play-list");l.forEach((t=>{const n=document.createElement("li"),o=document.createElement("button");o.classList.add("play"),o.classList.add("player-icon"),o.id=t.src,n.classList.add("play-item"),n.textContent=t.title,e.append(n),n.append(o)})),e.children[0].classList.add("item-active")}(),i(),p(),h(),s.addEventListener("loadeddata",(()=>{document.querySelector(".audio-time .length").textContent=m(s.duration),document.querySelector(".audio-time .divider").textContent="/",document.querySelector(".audio-time .current").textContent=m(s.currentTime),document.querySelector(".progress-bar").value=0,document.querySelector(".play-list").addEventListener("click",(e=>{if(s.paused&&e.target.classList.contains("play")){const t=document.querySelector(".play-list").getElementsByTagName("LI");for(let e=0;e<t.length;e++)t[e].classList.contains("item-active")&&t[e].classList.remove("item-active");e.target.parentNode.classList.add("item-active"),e.target.classList.toggle("pause"),i()}c()}))})),document.querySelector(".progress-bar").addEventListener("change",(e=>{s.currentTime=e.target.value})),setInterval((()=>{const e=document.querySelector(".progress-bar");s.paused||(console.log(Math.floor(s.duration)),console.log(Math.round(s.duration)),Math.round(s.currentTime)==Math.floor(s.duration)&&r(),e.value=s.currentTime/s.duration*100,document.querySelector(".audio-time .current").textContent=m(s.currentTime))}),500),localStorage.getItem("username")&&""!=localStorage.getItem("username")&&(document.getElementById("name").value=localStorage.getItem("username")),window.localStorage.getItem("city")||window.localStorage.setItem("city","Minsk"),document.getElementById("city").value=window.localStorage.getItem("city"),y(),a(),!window.localStorage.getItem("settings")){const e={lang:"en",imagesSource:"github",blocks:["weather","player","name","greeting","quote-container","date","time"]};window.localStorage.setItem("settings",JSON.stringify(e))}}));const I=document.getElementById("myModal"),w=(document.getElementById("settings"),document.getElementsByClassName("close")[0]);document.getElementById("slide-next").addEventListener("click",(function(){let e=Number(window.localStorage.getItem("imageNumber"));const t=window.localStorage.getItem("sliderImages").split(",");e==t.length-1?(window.localStorage.setItem("imageNumber",0),document.getElementById("body").style.backgroundImage=`url(${t[0]})`):(e+=1,window.localStorage.setItem("imageNumber",e),document.getElementById("body").style.backgroundImage=`url(${t[e]})`)})),document.getElementById("slide-prev").addEventListener("click",(function(){let e=Number(window.localStorage.getItem("imageNumber"));const t=window.localStorage.getItem("sliderImages").split(",");0==e?(window.localStorage.setItem("imageNumber",t.length-1),document.getElementById("body").style.backgroundImage=`url(${t[t.length-1]})`):(e-=1,window.localStorage.setItem("imageNumber",e),document.getElementById("body").style.backgroundImage=`url(${t[e]})`)})),document.getElementById("change-quote").addEventListener("click",a),document.getElementById("play").addEventListener("click",c),document.getElementById("play-next").addEventListener("click",r),document.getElementById("play-prev").addEventListener("click",(function(){let e=d(),t=document.getElementById("play-list");t.children[e].classList.toggle("item-active"),0==e?e=t.children.length-1:e-=1,t.children[e].classList.toggle("item-active"),i(),document.getElementById("play").classList.remove("pause"),c()})),document.getElementById("volume-button").addEventListener("click",(function(){let e=document.getElementById("volume-button"),t=document.getElementById("volume-bar");0==s.volume?s.volume=t.value/100:s.volume=0,e.classList.toggle("volume-muted")})),document.getElementById("volume-bar").addEventListener("change",(function(){let e=document.getElementById("volume-bar"),t=document.getElementById("volume-button");0==e.value?t.classList.add("volume-muted"):t.classList.remove("volume-muted"),s.volume=e.value/100})),document.getElementById("settings").addEventListener("click",(()=>{I.style.display="block",function(){const e=JSON.parse(window.localStorage.getItem("settings")),t=document.getElementById("switch-language"),n=document.getElementById("source");for(let t=0;t<n.getElementsByTagName("INPUT").length;t++)n.getElementsByTagName("INPUT")[t].id==e.imagesSource&&(n.getElementsByTagName("INPUT")[t].checked=!0);"github"!==e.imagesSource?document.getElementById("tags").style.display="block":document.getElementById("tags").style.display="none","ru"==e.lang?t.checked=!0:t.checked=!1;const o=document.getElementById("displayed-blocks").getElementsByTagName("INPUT");for(let t=0;t<o.length;t++)-1!=e.blocks.indexOf(o[t].id.split("_")[0])?o[t].checked=!0:o[t].checked=!1;document.getElementById("tags").value=e.tags}()})),w.addEventListener("click",(()=>{I.style.display="none"})),window.onclick=function(e){e.target==I&&(I.style.display="none")},document.getElementById("modal-button-save").addEventListener("click",(()=>{!function(){const e={};document.getElementById("switch-language").checked?e.lang="ru":e.lang="en";const t=document.getElementById("source").getElementsByTagName("INPUT");for(let n=0;n<t.length;n++)"radio"==t[n].type&&t[n].checked&&(e.imagesSource=t[n].id),"tags"==t[n].id&&(e.tags=t[n].value);const n=document.getElementById("displayed-blocks").getElementsByTagName("INPUT");let o=[];for(let e=0;e<n.length;e++)n[e].checked&&o.push(n[e].id.split("_")[0]);e.blocks=o,window.localStorage.setItem("settings",JSON.stringify(e))}(),u(g()),o(),e(),I.style.display="none",p(),h(),window.location.reload()})),document.getElementById("modal-button-exit").addEventListener("click",(()=>{I.style.display="none"}))})();